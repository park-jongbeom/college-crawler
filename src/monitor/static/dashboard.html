<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Crawler Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        /* Simple tooltip helper (no external deps). */
        .tooltip {
            position: relative;
            display: inline-flex;
            align-items: center;
        }
        .tooltip .tooltip-bubble {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.15s ease-in-out;
            position: absolute;
            z-index: 50;
            left: 50%;
            transform: translateX(-50%);
            bottom: calc(100% + 8px);
            width: 300px;
            max-width: 75vw;
            background: #111827; /* gray-900 */
            color: #fff;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 12px;
            line-height: 1.4;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .tooltip .tooltip-bubble::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: #111827 transparent transparent transparent;
        }
        .tooltip:hover .tooltip-bubble {
            visibility: visible;
            opacity: 1;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen" x-data="dashboard()" x-init="init()">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
            <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-3xl">🕷️</span>
                    <h1 class="text-2xl font-bold text-gray-900">College Crawler Monitor</h1>
                </div>
                <div class="flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center sm:gap-4">
                    <span class="text-sm text-gray-500" x-text="lastUpdate"></span>
                    <button @click="fetchData()" 
                            class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        🔄 새로고침
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
        <!-- Loading State -->
        <div x-show="loading" x-cloak class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
            <p class="mt-4 text-gray-600">데이터 로딩 중...</p>
        </div>

        <!-- Content -->
        <div x-show="!loading" x-cloak class="space-y-6">
            <!-- Status Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Container Status -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">컨테이너 상태</p>
                            <p class="text-2xl font-bold mt-1" 
                               :class="status.container?.running ? 'text-green-600' : 'text-red-600'"
                               x-text="status.container?.running ? 'Running' : 'Stopped'">
                            </p>
                        </div>
                        <div class="text-4xl">
                            <span x-show="status.container?.running">✅</span>
                            <span x-show="!status.container?.running">❌</span>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">
                        <span x-show="status.container?.health" 
                              x-text="'Health: ' + status.container?.health">
                        </span>
                    </div>
                </div>

                <!-- Database Status -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">데이터베이스</p>
                            <p class="text-2xl font-bold mt-1 text-blue-600" 
                               x-text="status.database?.total_schools || 0">
                            </p>
                        </div>
                        <div class="text-4xl">💾</div>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">
                        <span x-text="'이메일: ' + (status.database?.schools_with_email || 0) + '개'"></span>
                    </div>
                </div>

                <!-- CPU Usage -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">CPU 사용률</p>
                            <p class="text-2xl font-bold mt-1 text-purple-600" 
                               x-text="(status.resources?.cpu_percent || 0).toFixed(1) + '%'">
                            </p>
                        </div>
                        <div class="text-4xl">⚡</div>
                    </div>
                    <div class="mt-4">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-purple-600 h-2 rounded-full transition-all" 
                                 :style="'width: ' + (status.resources?.cpu_percent || 0) + '%'">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Memory Usage -->
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">메모리 사용량</p>
                            <p class="text-2xl font-bold mt-1 text-orange-600" 
                               x-text="(status.resources?.memory_usage_mb || 0).toFixed(0) + 'MB'">
                            </p>
                        </div>
                        <div class="text-4xl">🧠</div>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">
                        <span x-text="'/ ' + (status.resources?.memory_limit_mb || 0).toFixed(0) + 'MB'"></span>
                        <span class="ml-2" x-text="'(' + (status.resources?.memory_percent || 0).toFixed(1) + '%)'"></span>
                    </div>
                </div>
            </div>

            <!-- Crawling Statistics -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">📊 크롤링 통계</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div>
                            <div class="text-center">
                                <p class="text-4xl font-bold text-green-600" 
                                   x-text="status.crawling?.success || 0">
                                </p>
                                <p class="text-sm text-gray-600 mt-2">성공</p>
                            </div>
                        </div>
                        <div>
                            <div class="text-center">
                                <p class="text-4xl font-bold text-red-600" 
                                   x-text="status.crawling?.failed || 0">
                                </p>
                                <p class="text-sm text-gray-600 mt-2">실패</p>
                            </div>
                        </div>
                        <div>
                            <div class="text-center">
                                <p class="text-4xl font-bold text-yellow-600"
                                   x-text="status.crawling?.skipped || 0">
                                </p>
                                <p class="text-sm text-gray-600 mt-2">건너뜀</p>
                            </div>
                        </div>
                        <div>
                            <div class="text-center">
                                <p class="text-4xl font-bold text-blue-600" 
                                   x-text="(status.crawling?.success_rate || 0).toFixed(1) + '%'">
                                </p>
                                <p class="text-sm text-gray-600 mt-2">성공률</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6">
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-gradient-to-r from-green-500 to-blue-500 h-4 rounded-full transition-all" 
                                 :style="'width: ' + (status.crawling?.coverage_rate || 0) + '%'">
                            </div>
                        </div>
                        <p class="text-center text-sm text-gray-600 mt-2">
                            크롤링 완료율(커버리지): <span class="font-semibold" x-text="(status.crawling?.coverage_rate || 0).toFixed(1) + '%'"></span>
                        </p>
                        <p class="text-center text-xs text-gray-500 mt-1">
                            연락처 완료율(이메일): <span class="font-semibold" x-text="(status.database?.contact_completion_rate || status.database?.completion_rate || 0).toFixed(1) + '%'"></span>
                        </p>
                        <p class="text-center text-xs text-gray-500 mt-2">
                            최근 업데이트 학교: <span class="font-semibold" x-text="status.crawling?.recently_updated || 0"></span>개
                            <span class="mx-2">|</span>
                            마지막 크롤링: <span x-text="formatDate(status.crawling?.last_crawl)"></span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Scorecard Data Section -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">📊 College Scorecard Level 1 데이터 수집 현황</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Graduation Rate -->
                        <div class="border rounded-lg p-4">
                            <p class="text-sm text-gray-600 mb-2">졸업률 (Graduation Rate)</p>
                            <p class="text-3xl font-bold text-blue-600" 
                               x-text="status.database?.schools_with_graduation_rate || 0">
                            </p>
                            <p class="text-xs text-gray-500 mt-2">
                                <span class="font-semibold"
                                      x-text="status.database && status.database.total_schools ? 
                                          ((status.database.schools_with_graduation_rate / status.database.total_schools * 100) || 0).toFixed(1) + '%' : 
                                          '0%'">
                                </span>
                                커버리지
                            </p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all"
                                     :style="status.database && status.database.total_schools ? 
                                         'width: ' + ((status.database.schools_with_graduation_rate / status.database.total_schools * 100) || 0) + '%' : 
                                         'width: 0%'">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Average Salary -->
                        <div class="border rounded-lg p-4">
                            <p class="text-sm text-gray-600 mb-2">평균 연봉 (Average Salary)</p>
                            <p class="text-3xl font-bold text-green-600" 
                               x-text="status.database?.schools_with_average_salary || 0">
                            </p>
                            <p class="text-xs text-gray-500 mt-2">
                                <span class="font-semibold"
                                      x-text="status.database && status.database.total_schools ? 
                                          ((status.database.schools_with_average_salary / status.database.total_schools * 100) || 0).toFixed(1) + '%' : 
                                          '0%'">
                                </span>
                                커버리지
                            </p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-green-600 h-2 rounded-full transition-all"
                                     :style="status.database && status.database.total_schools ? 
                                         'width: ' + ((status.database.schools_with_average_salary / status.database.total_schools * 100) || 0) + '%' : 
                                         'width: 0%'">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Overall Scorecard Coverage -->
                        <div class="border rounded-lg p-4">
                            <p class="text-sm text-gray-600 mb-2">전체 Scorecard 커버리지</p>
                            <p class="text-3xl font-bold text-purple-600" 
                               x-text="status.database?.scorecard_coverage_rate ? 
                                   status.database.scorecard_coverage_rate.toFixed(1) + '%' : 
                                   '0%'">
                            </p>
                            <p class="text-xs text-gray-500 mt-2">
                                정량 메타데이터 보강
                            </p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div class="bg-purple-600 h-2 rounded-full transition-all"
                                     :style="'width: ' + (status.database?.scorecard_coverage_rate || 0) + '%'">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 text-center text-xs text-gray-500">
                        <span>하나 이상의 Scorecard 데이터가 있는 학교: </span>
                        <span class="font-semibold" x-text="status.database?.schools_with_any_scorecard || 0"></span>
                        <span> / </span>
                        <span x-text="status.database?.total_schools || 0"></span>
                    </div>
                </div>
            </div>

            <!-- Recent Schools -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <h2 class="text-xl font-semibold text-gray-900">🎓 최근 업데이트된 학교</h2>
                    <div class="w-full sm:w-auto">
                        <div class="grid grid-cols-2 gap-3 sm:flex sm:flex-wrap sm:items-end sm:gap-3">
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-600">주</label>
                                <select x-model="recentSchoolsState" @change="recentSchoolsPage=1; fetchRecentSchools(1)"
                                        class="rounded border border-gray-300 px-2 py-1.5 text-sm w-full sm:w-auto">
                                    <option value="">전체</option>
                                    <option value="CA">캘리포니아 (CA)</option>
                                    <option value="TX">텍사스 (TX)</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-600">학교 타입</label>
                                <select x-model="recentSchoolsType" @change="recentSchoolsPage=1; fetchRecentSchools(1)"
                                        class="rounded border border-gray-300 px-2 py-1.5 text-sm w-full sm:w-auto">
                                    <option value="">전체</option>
                                    <option value="community_college">Community College</option>
                                </select>
                            </div>
                            <div class="flex flex-col col-span-2 sm:col-span-1">
                                <label class="text-xs text-gray-600">이름 검색</label>
                                <input type="text" x-model="recentSchoolsQuery" placeholder="학교 이름 검색"
                                       @input="debounceSearch()"
                                       class="rounded border border-gray-300 px-2 py-1.5 text-sm w-full sm:w-56">
                            </div>
                            <div class="flex flex-col">
                                <label class="text-xs text-gray-600">페이지당</label>
                                <select x-model="recentSchoolsPerPage" @change="recentSchoolsPage=1; fetchRecentSchools(1)"
                                        class="rounded border border-gray-300 px-2 py-1.5 text-sm w-full sm:w-auto">
                                    <option value="10">10개</option>
                                    <option value="20">20개</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile: Card List -->
                <div class="sm:hidden divide-y divide-gray-200">
                    <template x-for="school in recentSchools" :key="school.id">
                        <div class="p-4 hover:bg-gray-50 cursor-pointer" @click="openSchoolDetail(school.id)">
                            <div class="flex items-start justify-between gap-3">
                                <div class="min-w-0">
                                    <div class="font-medium text-gray-900 truncate" x-text="school.name"></div>
                                    <div class="text-xs text-gray-500 mt-1" x-text="(school.city || '-') + ', ' + (school.state || '-')"></div>
                                </div>
                                <div class="flex-shrink-0">
                                    <span class="px-2 py-1 rounded text-xs font-medium"
                                          :class="statusBadgeClass(school.crawl_status)"
                                          :title="school.crawl_message || ''"
                                          x-text="statusLabel(school.crawl_status)">
                                    </span>
                                </div>
                            </div>

                            <div class="mt-2 text-xs text-gray-500 break-all">
                                <a :href="school.website"
                                   target="_blank"
                                   rel="noopener noreferrer"
                                   class="text-blue-600 hover:underline"
                                   @click.stop>
                                    <span x-text="school.website"></span>
                                </a>
                            </div>

                            <div class="mt-2 space-y-1 text-sm">
                                <div x-show="school.international_email" class="text-blue-600 break-all">
                                    📧 <span x-text="school.international_email"></span>
                                </div>
                                <div x-show="school.international_phone" class="text-green-600 break-all">
                                    📞 <span x-text="school.international_phone"></span>
                                </div>
                                <div x-show="!school.international_email && !school.international_phone" class="text-gray-400 text-sm">
                                    연락처 정보 없음
                                </div>
                            </div>

                            <div class="mt-2 text-xs text-gray-500">
                                크롤링 업데이트: <span x-text="formatDate(school.crawl_updated_at || school.updated_at)"></span>
                            </div>
                        </div>
                    </template>
                    <div x-show="recentSchools.length === 0" class="p-4 text-center text-sm text-gray-500">
                        표시할 학교가 없습니다.
                    </div>
                </div>

                <!-- Desktop/Tablet: Table -->
                <div class="hidden sm:block overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    학교명
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    위치
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    연락처
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    크롤링 상태
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    크롤링 업데이트
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="school in recentSchools" :key="school.id">
                                <tr class="hover:bg-gray-50 cursor-pointer" @click="openSchoolDetail(school.id)">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="font-medium text-gray-900" x-text="school.name"></div>
                                        <div class="text-sm text-gray-500">
                                            <a :href="school.website"
                                               target="_blank"
                                               rel="noopener noreferrer"
                                               class="hover:underline"
                                               @click.stop>
                                                <span x-text="school.website"></span>
                                            </a>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        <span x-text="school.city + ', ' + school.state"></span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <div x-show="school.international_email" class="text-blue-600">
                                            📧 <span x-text="school.international_email"></span>
                                        </div>
                                        <div x-show="school.international_phone" class="text-green-600">
                                            📞 <span x-text="school.international_phone"></span>
                                        </div>
                                        <div x-show="!school.international_email && !school.international_phone" class="text-gray-400">
                                            정보 없음
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <span class="px-2 py-1 rounded text-xs font-medium"
                                              :class="statusBadgeClass(school.crawl_status)"
                                              :title="school.crawl_message || ''"
                                              x-text="statusLabel(school.crawl_status)">
                                        </span>
                                        <div class="text-xs text-gray-500 mt-1 max-w-xs truncate"
                                             x-show="school.crawl_message"
                                             :title="school.crawl_message"
                                             x-text="school.crawl_message">
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <span x-text="formatDate(school.crawl_updated_at || school.updated_at)"></span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                <div class="px-6 py-3 border-t border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 bg-gray-50">
                    <p class="text-sm text-gray-600">
                        총 <span class="font-semibold" x-text="recentSchoolsTotal"></span>개 중
                        <span x-show="recentSchoolsTotal > 0" x-text="(recentSchoolsPage - 1) * recentSchoolsPerPage + 1"></span>
                        <span x-show="recentSchoolsTotal === 0">0</span>
                        –
                        <span x-text="Math.min(recentSchoolsPage * recentSchoolsPerPage, recentSchoolsTotal)"></span> 표시
                    </p>
                    <div class="flex items-center gap-1 max-w-full overflow-x-auto py-1">
                        <button @click="fetchRecentSchools(recentSchoolsPage - 1)"
                                :disabled="recentSchoolsPage <= 1"
                                class="px-3 py-1 rounded border text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200">
                            이전
                        </button>
                        <template x-for="n in recentSchoolsPageNumbers" :key="n">
                            <button @click="fetchRecentSchools(n)"
                                    :class="n === recentSchoolsPage ? 'bg-blue-600 text-white' : 'hover:bg-gray-200'"
                                    class="w-8 h-8 rounded text-sm">
                                <span x-text="n"></span>
                            </button>
                        </template>
                        <button @click="fetchRecentSchools(recentSchoolsPage + 1)"
                                :disabled="recentSchoolsPage >= recentSchoolsTotalPages"
                                class="px-3 py-1 rounded border text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200">
                            다음
                        </button>
                    </div>
                </div>
            </div>

            <!-- Failed Sites -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                    <h2 class="text-xl font-semibold text-gray-900">건너뜀 사이트 (SSL 검증 오류)</h2>
                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium"
                          x-text="'총 ' + failedSites.length + '개'">
                    </span>
                </div>

                <!-- Mobile: Card List -->
                <div class="sm:hidden divide-y divide-gray-200">
                    <template x-for="site in failedSites" :key="site.website">
                        <div class="p-4 hover:bg-gray-50 cursor-pointer" @click="openFailedSiteDetail(site)">
                            <div class="flex items-start justify-between gap-3">
                                <div class="min-w-0">
                                    <div class="text-sm font-medium text-gray-900 truncate" x-text="site.name"></div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        최초 실패: <span x-text="formatDate(site.first_failed_at)"></span>
                                        <span class="mx-1">|</span>
                                        재시도: <span x-text="site.retry_count || 0"></span>회
                                    </div>
                                </div>
                                <div class="flex-shrink-0">
                                    <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium"
                                          x-text="(site.retry_count || 0) + '회'">
                                    </span>
                                </div>
                            </div>
                            <div class="mt-2 text-xs break-all">
                                <a :href="site.website" target="_blank" rel="noopener noreferrer"
                                   class="text-blue-600 hover:text-blue-800"
                                   @click.stop>
                                    <span x-text="site.website"></span>
                                </a>
                            </div>
                            <div class="mt-2 text-xs text-gray-600 break-words" x-text="site.error_message"></div>
                        </div>
                    </template>
                    <div x-show="failedSites.length === 0" class="p-4 text-center text-sm text-gray-500">
                        실패한 사이트가 없습니다.
                    </div>
                </div>

                <!-- Desktop/Tablet: Table -->
                <div class="hidden sm:block overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    학교명
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    웹사이트
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    에러 메시지
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    최초 실패
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    재시도 횟수
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="site in failedSites" :key="site.website">
                                <tr class="hover:bg-gray-50 cursor-pointer" @click="openFailedSiteDetail(site)">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900" x-text="site.name"></div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <a :href="site.website" target="_blank" rel="noopener noreferrer"
                                           class="text-sm text-blue-600 hover:text-blue-800 break-all"
                                           @click.stop>
                                            <span x-text="site.website"></span>
                                        </a>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="text-xs text-gray-600 max-w-md truncate"
                                             :title="site.error_message"
                                             x-text="site.error_message">
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-500" x-text="formatDate(site.first_failed_at)"></div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-center">
                                        <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium"
                                              x-text="(site.retry_count || 0) + '회'">
                                        </span>
                                    </td>
                                </tr>
                            </template>
                            <tr x-show="failedSites.length === 0">
                                <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">
                                    실패한 사이트가 없습니다.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="px-6 py-3 bg-gray-50 text-xs text-gray-600">
                    SSL 검증 실패 사이트는 다음 크롤링에서 자동으로 건너뜁니다.
                </div>
            </div>

            <!-- Recent Logs -->
            <div class="bg-white rounded-lg shadow">
                <div class="px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                    <h2 class="text-xl font-semibold text-gray-900">📝 최근 로그</h2>
                    <button @click="fetchLogs()" 
                            class="w-full sm:w-auto text-sm px-3 py-2 sm:py-1 bg-gray-100 hover:bg-gray-200 rounded transition">
                        새로고침
                    </button>
                </div>
                <div class="p-6">
                    <div class="bg-gray-900 rounded-lg p-4 max-h-96 overflow-y-auto font-mono text-sm">
                        <template x-for="log in logs" :key="log.timestamp">
                            <div class="text-gray-300 py-1 hover:bg-gray-800 px-2 rounded">
                                <span class="text-gray-500" x-text="log.timestamp"></span>
                                <span class="ml-2" x-text="log.message"></span>
                            </div>
                        </template>
                        <div x-show="logs.length === 0" class="text-gray-500 text-center py-4">
                            로그가 없습니다.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- School Detail Modal -->
    <div x-show="showModal" x-cloak class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="w-full max-w-4xl max-h-[85vh] overflow-y-auto bg-white rounded-lg shadow-xl">
            <div class="px-6 py-4 border-b border-gray-200 flex items-start justify-between">
                <div>
                    <h3 class="text-xl font-semibold text-gray-900" x-text="selectedSchool?.name || '학교 상세 정보'"></h3>
                    <p class="text-sm text-gray-500 mt-1" x-text="selectedSchool?.website || '-'"></p>
                </div>
                <button @click="closeSchoolDetail()"
                        class="text-gray-500 hover:text-gray-700 text-sm px-3 py-1 rounded bg-gray-100 hover:bg-gray-200 transition">
                    닫기
                </button>
            </div>

            <div class="p-6 space-y-6">
                <div x-show="detailLoading" class="text-sm text-gray-600">상세 데이터 로딩 중...</div>
                <div x-show="detailError" class="text-sm text-red-600" x-text="detailError"></div>

                <div x-show="selectedSchool && !detailLoading" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div class="bg-gray-50 rounded p-4">
                        <h4 class="font-semibold text-gray-900 mb-2">기본 정보</h4>
                        <p><span class="text-gray-500">타입:</span> <span x-text="selectedSchool?.type || '-'"></span></p>
                        <p><span class="text-gray-500">위치:</span> <span x-text="(selectedSchool?.city || '-') + ', ' + (selectedSchool?.state || '-')"></span></p>
                        <p><span class="text-gray-500">업데이트:</span> <span x-text="formatDate(selectedSchool?.updated_at)"></span></p>
                    </div>
                    <div class="bg-gray-50 rounded p-4">
                        <h4 class="font-semibold text-gray-900 mb-2">연락처</h4>
                        <p><span class="text-gray-500">이메일:</span> <span x-text="selectedSchool?.international_email || '-'"></span></p>
                        <p><span class="text-gray-500">전화:</span> <span x-text="selectedSchool?.international_phone || '-'"></span></p>
                    </div>
                </div>

                <!-- Scorecard Data Badge -->
                <div x-show="selectedSchool && !detailLoading && (selectedSchool?.graduation_rate || selectedSchool?.average_salary || selectedSchool?.acceptance_rate || selectedSchool?.employment_rate)" 
                     class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-blue-900">
                            📊 Scorecard Level 1 데이터
                        </h4>
                        <div class="tooltip">
                            <span class="text-blue-700 cursor-help select-none" aria-label="Scorecard 도움말">ℹ️</span>
                            <div class="tooltip-bubble">
                                <div class="font-semibold mb-1">이 데이터는 무엇인가요?</div>
                                <div>
                                    미국 교육부(Department of Education)에서 제공하는 College Scorecard의 정량 지표입니다.
                                    학교/코호트에 따라 일부 값은 제공되지 않을 수 있으며, 매칭 성공 시에만 채워집니다.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div x-show="selectedSchool?.graduation_rate" class="bg-white rounded p-3">
                            <div class="flex items-center gap-1">
                                <p class="text-gray-600">졸업률</p>
                                <div class="tooltip">
                                    <span class="text-gray-400 cursor-help select-none text-xs" aria-label="졸업률 설명">ⓘ</span>
                                    <div class="tooltip-bubble">
                                        <div class="font-semibold mb-1">졸업률(Graduation Rate)</div>
                                        <div>일반적으로 150% 기간 내(예: 4년 과정이면 6년 내) 학위 취득 비율입니다.</div>
                                        <div class="mt-2 text-gray-200">출처: College Scorecard API (latest.completion)</div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-blue-600">
                                <span x-text="selectedSchool?.graduation_rate"></span>%
                            </p>
                            <p class="text-xs text-gray-500 mt-1">정해진 기간 내 학위 취득 비율</p>
                        </div>
                        <div x-show="selectedSchool?.average_salary" class="bg-white rounded p-3">
                            <div class="flex items-center gap-1">
                                <p class="text-gray-600">평균 연봉</p>
                                <div class="tooltip">
                                    <span class="text-gray-400 cursor-help select-none text-xs" aria-label="평균 연봉 설명">ⓘ</span>
                                    <div class="tooltip-bubble">
                                        <div class="font-semibold mb-1">평균 연봉(Average Salary)</div>
                                        <div>입학 후 일정 기간(예: 6년/10년) 시점의 소득 지표(주로 median earnings)를 의미합니다.</div>
                                        <div class="mt-2 text-gray-200">출처: College Scorecard API (latest.earnings)</div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-green-600">
                                $<span x-text="selectedSchool?.average_salary ? selectedSchool.average_salary.toLocaleString() : '-'"></span>
                            </p>
                            <p class="text-xs text-gray-500 mt-1">입학 후 일정 기간 소득 지표</p>
                        </div>
                        <div x-show="selectedSchool?.acceptance_rate" class="bg-white rounded p-3">
                            <div class="flex items-center gap-1">
                                <p class="text-gray-600">입학률</p>
                                <div class="tooltip">
                                    <span class="text-gray-400 cursor-help select-none text-xs" aria-label="입학률 설명">ⓘ</span>
                                    <div class="tooltip-bubble">
                                        <div class="font-semibold mb-1">입학률(Acceptance Rate)</div>
                                        <div>지원자 대비 합격자 비율입니다. 값이 낮을수록 경쟁이 치열할 수 있습니다.</div>
                                        <div class="mt-2 text-gray-200">출처: College Scorecard API (latest.admissions)</div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-purple-600">
                                <span x-text="selectedSchool?.acceptance_rate"></span>%
                            </p>
                            <p class="text-xs text-gray-500 mt-1">지원자 대비 합격 비율</p>
                        </div>
                        <div x-show="selectedSchool?.employment_rate" class="bg-white rounded p-3">
                            <div class="flex items-center gap-1">
                                <p class="text-gray-600">취업률</p>
                                <div class="tooltip">
                                    <span class="text-gray-400 cursor-help select-none text-xs" aria-label="취업률 설명">ⓘ</span>
                                    <div class="tooltip-bubble">
                                        <div class="font-semibold mb-1">취업률(Employment Rate)</div>
                                        <div>현재 크롤러가 수집/추정하는 취업 관련 지표입니다(Scorecard 값과 다를 수 있음).</div>
                                        <div class="mt-2 text-gray-200">출처: 크롤러 수집 결과(website/문서/구조화 데이터)</div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-orange-600">
                                <span x-text="selectedSchool?.employment_rate"></span>%
                            </p>
                            <p class="text-xs text-gray-500 mt-1">취업 관련 지표(크롤러 수집)</p>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-blue-200">
                        <p class="text-xs text-gray-700">
                            출처: U.S. Department of Education College Scorecard API (졸업률/입학률/연봉) + 크롤러 수집(취업률)
                        </p>
                    </div>
                </div>

                <div x-show="selectedSchool && !detailLoading" class="space-y-3">
                    <div class="flex items-center gap-2">
                        <h4 class="font-semibold text-gray-900">수집 데이터</h4>
                        <div class="tooltip">
                            <span class="text-gray-400 cursor-help select-none text-xs" aria-label="수집 데이터 도움말">ⓘ</span>
                            <div class="tooltip-bubble">
                                <div class="font-semibold mb-1">수집 데이터는 무엇인가요?</div>
                                <div>크롤러가 각 학교 웹사이트/문서에서 best-effort로 수집한 구조화(JSON) 정보입니다.</div>
                                <div class="mt-2 text-gray-200">출처: college-crawler</div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded p-4 text-sm">
                        <div class="flex items-center gap-1 mb-2">
                            <p class="text-gray-600">ESL 프로그램</p>
                            <div class="tooltip">
                                <span class="text-gray-400 cursor-help select-none text-xs" aria-label="ESL 프로그램 설명">ⓘ</span>
                                <div class="tooltip-bubble">
                                    <div class="font-semibold mb-1">ESL 프로그램</div>
                                    <div>영어 어학(ESL) 과정/지원 여부 등 관련 정보를 JSON 형태로 저장합니다.</div>
                                    <div class="mt-2 text-gray-200">출처: 크롤러 수집 (schools.esl_program)</div>
                                </div>
                            </div>
                        </div>
                        <pre class="whitespace-pre-wrap break-words text-xs text-gray-800" x-text="formatDetailValue(selectedSchool?.esl_program)"></pre>
                    </div>
                    <div class="bg-gray-50 rounded p-4 text-sm">
                        <div class="flex items-center gap-1 mb-2">
                            <p class="text-gray-600">유학생 지원</p>
                            <div class="tooltip">
                                <span class="text-gray-400 cursor-help select-none text-xs" aria-label="유학생 지원 설명">ⓘ</span>
                                <div class="tooltip-bubble">
                                    <div class="font-semibold mb-1">유학생 지원</div>
                                    <div>국제학생 오피스/비자/오리엔테이션/상담 등 지원 정보를 JSON 형태로 저장합니다.</div>
                                    <div class="mt-2 text-gray-200">출처: 크롤러 수집 (schools.international_support)</div>
                                </div>
                            </div>
                        </div>
                        <pre class="whitespace-pre-wrap break-words text-xs text-gray-800" x-text="formatDetailValue(selectedSchool?.international_support)"></pre>
                    </div>
                    <div class="bg-gray-50 rounded p-4 text-sm">
                        <div class="flex items-center gap-1 mb-2">
                            <p class="text-gray-600">시설 정보</p>
                            <div class="tooltip">
                                <span class="text-gray-400 cursor-help select-none text-xs" aria-label="시설 정보 설명">ⓘ</span>
                                <div class="tooltip-bubble">
                                    <div class="font-semibold mb-1">시설 정보</div>
                                    <div>기숙사/도서관/체육관 등 학교 시설 관련 정보를 JSON 형태로 저장합니다.</div>
                                    <div class="mt-2 text-gray-200">출처: 크롤러 수집 (schools.facilities)</div>
                                </div>
                            </div>
                        </div>
                        <pre class="whitespace-pre-wrap break-words text-xs text-gray-800" x-text="formatDetailValue(selectedSchool?.facilities)"></pre>
                    </div>
                </div>

                <div x-show="!detailLoading">
                    <h4 class="font-semibold text-gray-900 mb-3">최근 크롤링 이력</h4>
                    <div class="space-y-2">
                        <template x-for="log in crawlHistory" :key="log.id">
                            <div class="border rounded p-3 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="px-2 py-1 rounded text-xs font-medium"
                                          :class="statusBadgeClass(log.status)"
                                          x-text="statusLabel(log.status)">
                                    </span>
                                    <span class="text-gray-500" x-text="formatDate(log.timestamp)"></span>
                                </div>
                                <p class="mt-2 text-gray-700" x-text="log.message || '-'"></p>
                            </div>
                        </template>
                        <div x-show="crawlHistory.length === 0" class="text-sm text-gray-500">
                            크롤링 이력이 없습니다.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Failed Site Detail Modal -->
    <div x-show="showFailedSiteModal" x-cloak class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
        <div class="w-full max-w-3xl max-h-[85vh] overflow-y-auto bg-white rounded-lg shadow-xl">
            <div class="px-6 py-4 border-b border-gray-200 flex items-start justify-between">
                <div>
                    <h3 class="text-xl font-semibold text-gray-900" x-text="selectedFailedSite?.name || '실패 사이트 상세'"></h3>
                    <p class="text-sm text-red-600 mt-1" x-text="selectedFailedSite?.website || '-'"></p>
                </div>
                <button @click="closeFailedSiteDetail()"
                        class="text-gray-500 hover:text-gray-700 text-sm px-3 py-1 rounded bg-gray-100 hover:bg-gray-200 transition">
                    닫기
                </button>
            </div>

            <div class="p-6 space-y-4">
                <div x-show="failedDetailLoading" class="text-sm text-gray-600">실패 로그 로딩 중...</div>
                <div x-show="failedDetailError" class="text-sm text-red-600" x-text="failedDetailError"></div>

                <div x-show="selectedFailedSite && !failedDetailLoading" class="space-y-4">
                    <div class="bg-red-50 rounded p-4">
                        <h4 class="font-semibold text-red-900 mb-2">에러 유형</h4>
                        <p class="text-sm text-red-800" x-text="selectedFailedSite?.error_type || '-'"></p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 rounded p-4">
                            <h4 class="font-semibold text-gray-900 mb-2">최초 실패 시각</h4>
                            <p class="text-sm" x-text="formatDate(selectedFailedSite?.first_failed_at)"></p>
                        </div>
                        <div class="bg-gray-50 rounded p-4">
                            <h4 class="font-semibold text-gray-900 mb-2">마지막 확인</h4>
                            <p class="text-sm" x-text="formatDate(selectedFailedSite?.last_checked_at)"></p>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded p-4">
                        <h4 class="font-semibold text-gray-900 mb-2">재시도 횟수</h4>
                        <p class="text-2xl font-bold text-red-600" x-text="(selectedFailedSite?.retry_count || 0) + '회'"></p>
                    </div>

                    <div class="bg-yellow-50 rounded p-4" x-show="selectedFailedSite?.note">
                        <h4 class="font-semibold text-yellow-900 mb-2">참고 사항</h4>
                        <p class="text-sm text-yellow-800" x-text="selectedFailedSite?.note || '-'"></p>
                    </div>

                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">실패 로그 전체</h4>
                        <div class="space-y-2">
                            <template x-for="log in failedSiteLogs" :key="log.id + '_' + log.timestamp">
                                <div class="border rounded p-3 text-sm">
                                    <div class="flex items-center justify-between">
                                        <span class="px-2 py-1 rounded text-xs font-medium"
                                              :class="statusBadgeClass(log.status)"
                                              x-text="statusLabel(log.status)">
                                        </span>
                                        <span class="text-gray-500" x-text="formatDate(log.timestamp)"></span>
                                    </div>
                                    <pre class="mt-2 text-xs text-gray-700 whitespace-pre-wrap break-words" x-text="log.message || '-'"></pre>
                                </div>
                            </template>
                            <div x-show="failedSiteLogs.length === 0" class="text-sm text-gray-500">
                                실패 로그가 없습니다.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 pb-8 text-center text-sm text-gray-500">
        <p>College Crawler Monitor v1.0.0 | 
           <span x-show="autoRefresh" class="text-green-600">● 자동 새로고침 (30초)</span>
           <span x-show="!autoRefresh" class="text-gray-400">○ 자동 새로고침 꺼짐</span>
        </p>
    </footer>

    <script>
        function dashboard() {
            return {
                status: {},
                recentSchools: [],
                recentSchoolsPage: 1,
                recentSchoolsTotal: 0,
                recentSchoolsTotalPages: 0,
                recentSchoolsPageNumbers: [],
                recentSchoolsPerPage: 20,
                recentSchoolsState: '',
                recentSchoolsType: '',
                recentSchoolsQuery: '',
                recentSchoolsSearchTimer: null,
                failedSites: [],
                logs: [],
                loading: true,
                lastUpdate: '로딩 중...',
                autoRefresh: true,
                refreshInterval: null,
                showModal: false,
                selectedSchool: null,
                crawlHistory: [],
                detailLoading: false,
                detailError: '',
                showFailedSiteModal: false,
                selectedFailedSite: null,
                failedSiteLogs: [],
                failedDetailLoading: false,
                failedDetailError: '',

                async init() {
                    await this.fetchData();
                    await this.fetchLogs();
                    await this.fetchRecentSchools(1);
                    await this.fetchFailedSites();
                    
                    // 자동 새로고침 (30초마다)
                    this.refreshInterval = setInterval(() => {
                        if (this.autoRefresh) {
                            this.fetchData();
                            this.fetchFailedSites();
                            this.fetchLogs();
                            this.fetchRecentSchools(this.recentSchoolsPage);
                        }
                    }, 30000);
                },

                debounceSearch() {
                    if (this.recentSchoolsSearchTimer) clearTimeout(this.recentSchoolsSearchTimer);
                    this.recentSchoolsSearchTimer = setTimeout(() => {
                        this.recentSchoolsPage = 1;
                        this.fetchRecentSchools(1);
                    }, 300);
                },

                async fetchData() {
                    try {
                        const response = await fetch('./api/status');
                        this.status = await response.json();
                        this.lastUpdate = new Date().toLocaleString('ko-KR');
                        this.loading = false;
                    } catch (error) {
                        console.error('데이터 로딩 실패:', error);
                        this.loading = false;
                    }
                },

                async fetchRecentSchools(page) {
                    const p = page ?? this.recentSchoolsPage;
                    try {
                        const params = new URLSearchParams();
                        params.set('page', String(p));
                        params.set('per_page', String(this.recentSchoolsPerPage));
                        if (this.recentSchoolsState) params.set('state', this.recentSchoolsState);
                        if (this.recentSchoolsType) params.set('school_type', this.recentSchoolsType);
                        if (this.recentSchoolsQuery && this.recentSchoolsQuery.trim()) params.set('q', this.recentSchoolsQuery.trim());
                        const response = await fetch('./api/schools/recent?' + params.toString());
                        const data = await response.json();
                        this.recentSchools = data.items || [];
                        this.recentSchoolsTotal = data.total ?? 0;
                        this.recentSchoolsPage = data.page ?? 1;
                        this.recentSchoolsTotalPages = data.total_pages ?? 0;
                        this.recentSchoolsPageNumbers = Array.from({ length: this.recentSchoolsTotalPages }, (_, i) => i + 1);
                    } catch (error) {
                        console.error('학교 목록 로딩 실패:', error);
                    }
                },

                async fetchLogs() {
                    try {
                        const response = await fetch('./api/logs/recent?lines=50');
                        const data = await response.json();
                        this.logs = data.logs || [];
                    } catch (error) {
                        console.error('로그 로딩 실패:', error);
                    }
                },

                async fetchFailedSites() {
                    try {
                        const response = await fetch('./api/failed-sites');
                        const data = await response.json();
                        this.failedSites = data.ssl_failures || [];
                    } catch (error) {
                        console.error('실패 사이트 로딩 실패:', error);
                        this.failedSites = [];
                    }
                },

                async openSchoolDetail(schoolId) {
                    this.showModal = true;
                    this.detailLoading = true;
                    this.detailError = '';
                    this.selectedSchool = null;
                    this.crawlHistory = [];
                    try {
                        const response = await fetch(`./api/schools/${schoolId}`);
                        if (!response.ok) {
                            throw new Error(`상세 API 호출 실패 (${response.status})`);
                        }
                        const data = await response.json();
                        this.selectedSchool = data.school || null;
                        this.crawlHistory = data.crawl_history || [];
                    } catch (error) {
                        console.error('학교 상세 정보 로딩 실패:', error);
                        this.detailError = '학교 상세 정보를 불러오지 못했습니다.';
                    } finally {
                        this.detailLoading = false;
                    }
                },

                closeSchoolDetail() {
                    this.showModal = false;
                    this.detailError = '';
                },

                async openFailedSiteDetail(site) {
                    this.showFailedSiteModal = true;
                    this.selectedFailedSite = site || null;
                    this.failedSiteLogs = [];
                    this.failedDetailError = '';
                    this.failedDetailLoading = true;
                    try {
                        const response = await fetch(`./api/failed-sites/detail?website=${encodeURIComponent(site.website || '')}`);
                        if (!response.ok) {
                            throw new Error(`실패 상세 API 호출 실패 (${response.status})`);
                        }
                        const data = await response.json();
                        this.selectedFailedSite = data.site || site;
                        this.failedSiteLogs = data.logs || [];
                    } catch (error) {
                        console.error('실패 사이트 상세 로딩 실패:', error);
                        this.failedDetailError = '실패 상세 로그를 불러오지 못했습니다.';
                        this.failedSiteLogs = [];
                    } finally {
                        this.failedDetailLoading = false;
                    }
                },

                closeFailedSiteDetail() {
                    this.showFailedSiteModal = false;
                    this.selectedFailedSite = null;
                    this.failedSiteLogs = [];
                    this.failedDetailError = '';
                },

                statusLabel(status) {
                    if (status === 'success') return '성공';
                    if (status === 'failed') return '실패';
                    if (status === 'skipped') return '건너뜀';
                    return '미확인';
                },

                statusBadgeClass(status) {
                    if (status === 'success') return 'bg-green-100 text-green-800';
                    if (status === 'failed') return 'bg-red-100 text-red-800';
                    if (status === 'skipped') return 'bg-gray-100 text-gray-800';
                    return 'bg-yellow-100 text-yellow-800';
                },

                formatDetailValue(value) {
                    if (value === null || value === undefined || value === '') {
                        return '-';
                    }
                    if (typeof value === 'object') {
                        try {
                            return JSON.stringify(value, null, 2);
                        } catch (error) {
                            return String(value);
                        }
                    }
                    return String(value);
                },

                formatDate(dateString) {
                    if (!dateString) return '-';
                    const date = new Date(dateString);
                    return date.toLocaleString('ko-KR', {
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            }
        }
    </script>
</body>
</html>
